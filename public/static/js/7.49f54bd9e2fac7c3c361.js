webpackJsonp([7],{"3FEb":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),i=a.n(s),n=a("2bvH"),r=a("zyNP"),o={data:function(){return{tableData:[],total:1,paginationShow:!0,inputPlan:"",kw:""}},props:["siteData"],computed:{getUpdate:function(){return this.siteData}},watch:{getUpdate:function(){this.loadSideData(0)}},created:function(){this.loadSideData(0)},methods:{handleEdit:function(t,e){console.log(t,e)},handleDelete:function(t,e){var a=this,s=new URLSearchParams;s.append("areaId",e.areaId),this.$post(this.url+"/xhHlck/deleteXhArea",s).then(function(t){200==t.code?(a.$message({message:"删除成功",type:"success"}),a.loadSideData(0)):a.$message.error("删除失败")})},loadSideData:function(t){var e=this,a=new URLSearchParams;a.append("pageNum",t),a.append("pageSize",10),this.$post(this.url+"/xhHlck/getXhArea",a).then(function(t){200==t.code?(e.total=JSON.parse(t.data).total,e.tableData=JSON.parse(t.data).list):e.$message.error("新增失败")})},handleCurrentChange:function(t){this.loadSideData(t)},search:function(){var t=this;if(this.inputPlan){var e=new URLSearchParams;e.append("areaName",this.inputPlan),this.$post(this.url+"/xhHlck/getXhArea",e).then(function(e){200==e.code?(t.total=JSON.parse(e.data).total,t.tableData=JSON.parse(e.data).list):t.$message.error("新增失败")})}else this.$message({message:"搜索内容不能为空",type:"warning"})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"siteData"},[a("div",{staticClass:"search"},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"搜索内容"},model:{value:t.kw,callback:function(e){t.kw=e},expression:"kw"}},[a("el-button",{attrs:{slot:"append",type:"primary"},slot:"append"},[t._v("搜索")])],1)],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[a("el-table-column",{attrs:{label:"检查站名称",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.areaName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"盘查地点",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.locationName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"盘查范围",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.radius/1e3)+" km")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.createTime))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),t.paginationShow?a("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}}):t._e()],1)},staticRenderFns:[]};var c=a("VU/8")(o,l,!1,function(t){a("PJJV")},"data-v-2fbcdaf2",null).exports,u=a("LmyP"),p={name:"HelloWorld",data:function(){return{msg:"Welcome to Your Vue.js App",curNum:1,inputPlan:"",mapResult:[],siteName:"",setSiteButton:!1,prevClickNum:-1,teskName:"",radius:1,noData:!0,map:"",siteData:Object,geojson:{type:"FeatureCollection",features:[]}}},mounted:function(){this.loadMap()},computed:i()({},Object(n.b)({pageNum:"pageNum"})),watch:{pageNum:function(){this.curNum=this.pageNum,this.curNum&&this.searchSite()}},methods:{loadMap:function(){minemap.domainUrl=this.mapUrl,minemap.dataDomainUrl=this.dataDomainUrl,minemap.spriteUrl=this.mapUrl+"/minemapapi/"+this.version+"/sprite/sprite",minemap.serviceUrl=this.mapUrl+"/service",minemap.accessToken="25cc55a69ea7422182d00d6b7c0ffa93",minemap.solution=2365,this.map=new minemap.Map({container:"map",style:this.mapUrl+"/service/solu/style/id/2365",center:[106.71,26.57],zoom:10,pitch:0,maxZoom:17,minZoom:3}),this.map.getCanvas().style.cursor="pointer",this.mapClick()},mapClick:function(){var t=this;this.map.on("click",function(e){var a=e.lngLat,s=a.lng,i=a.lat;t.mark([s,i],t.radius,10),minemap.service.queryReverseGeoCodingResult([s,i].join(","),t.radius,1e3,1e3,0,function(e,a){e?t.$message.error("查询结果失败"):(t.teskName=a.data.restName,t.searchSite())})})},cancle:function(){this.loadMap(),this.$refs.coordinates[this.prevClickNum].style.display="none"},searchSite:function(){var t=this;this.teskName?minemap.service.queryRoadSearchResult("520000",this.teskName,this.curNum,10,function(e,a){e?t.$message.error("查询结果失败"):(t.noData=!1,t.mapResult=a.data.rows,console.log(a.data),t.$store.commit("PAGE",{pageTotal:a.data.totalCount}))}):this.$message({message:"搜索名不能为空",type:"warning"})},prevCircle:function(t,e,a){try{this.$refs.coordinates[this.prevClickNum].style.display="none"}catch(t){}this.radius?(this.prevClickNum=t,this.$refs.coordinates[t].style.display="block",this.mark(e,this.radius,a)):this.$message({message:"不能为空",type:"warning"})},mark:function(t,e,a){var s=this;if(12==a){this.map=new minemap.Map({container:"map",style:this.mapUrl+"/service/solu/style/id/2365",center:t,zoom:a,pitch:0,maxZoom:17,minZoom:3});var i=t,n=turf.circle(i,e,{steps:64,units:"kilometers",properties:{foo:"bar"}});this.map.on("load",function(){s.map.addSource("polygon",{type:"geojson",data:n}),s.map.addLayer({id:"polygon",type:"fill",source:"polygon",layout:{},paint:{"fill-color":"blue","fill-opacity":.6}})})}},setSite:function(t,e){var a=this;if(this.siteName){var s=new URLSearchParams;s.append("areaName",this.siteName),s.append("locationName",t),s.append("longitude",e[0]),s.append("latitude",e[1]),s.append("radius",1e3*this.radius),this.$post(this.url+"/xhHlck/addXhArea",s).then(function(t){200==t.code?(a.$message({message:"新增成功",type:"success"}),a.loadMap(),a.$refs.coordinates[a.prevClickNum].style.display="none",a.siteData={upDate:!0}):a.$message.error("新增失败")})}else this.$message({message:"站点名不能为空",type:"warning"})}},components:{zTree:r.a,siteData:c,paging:u.a}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lowerTesk"},[t._m(0),t._v(" "),a("div",{staticClass:"site"},[a("div",{staticClass:"siteSearch"},[t._m(1),t._v(" "),a("div",{staticClass:"siteManageContent"},[a("div",{staticClass:"params"},[a("p",[a("span",[t._v("盘查半径：")]),t._v(" "),a("el-input-number",{staticClass:"radius",attrs:{min:1,max:100,label:"描述文字"},model:{value:t.radius,callback:function(e){t.radius=e},expression:"radius"}}),t._v(" "),a("em",[t._v("km")])],1),t._v(" "),a("p",[a("span",[t._v("站点名：")]),t._v(" "),a("el-input",{staticClass:"radius",attrs:{placeholder:"请输入内容"},model:{value:t.siteName,callback:function(e){t.siteName=e},expression:"siteName"}})],1),t._v(" "),a("p",[a("span",{staticStyle:{"margin-right":"10px"}},[t._v("搜索名：")]),t._v(" "),a("el-input",{staticClass:"searchSite",attrs:{placeholder:"请输入搜索内容"},model:{value:t.teskName,callback:function(e){t.teskName=e},expression:"teskName"}}),t._v(" "),a("el-button",{staticClass:"searchButtom",attrs:{type:"primary",round:""},on:{click:t.searchSite}},[t._v("搜索")])],1)]),t._v(" "),a("div",{staticClass:"result"},[a("p",[t._v("搜索结果")]),t._v(" "),a("div",{staticClass:"resultContent"},[t.noData?a("div",{staticClass:"noData"},[t._v("\n              暂无结果\n            ")]):t._e(),t._v(" "),t._l(t.mapResult,function(e,s){return a("div",{key:s,staticClass:"content"},[a("div",{staticClass:"contentLeft",on:{click:function(a){return t.prevCircle(s,e.geom_display.coordinates,12)}}},[a("span",[t._v(t._s(s+1))]),t._v(" "),a("p",{staticStyle:{"margin-bottom":"5px","font-size":"14px"}},[t._v(t._s(e.name))]),t._v(" "),a("p",{staticStyle:{color:"#676767"}},[t._v(t._s(e.address))])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.setSiteButton,expression:"setSiteButton"}],ref:"coordinates",refInFor:!0,staticClass:"contentRight"},[a("span",{on:{click:function(a){return t.setSite(e.address,e.geom_display.coordinates)}}},[t._v("设置站点")]),t._v(" "),a("span",{staticStyle:{"margin-top":"4px",background:"rgb(249, 5, 5)"},on:{click:function(e){return t.cancle()}}},[t._v("取消")])])])}),t._v(" "),a("paging")],2)])]),t._v(" "),a("div",{attrs:{id:"map"}}),t._v(" "),a("siteData",{attrs:{siteData:t.siteData}})],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"lowerTeskTitle"},[e("p",[this._v("站点管理")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("盘查站点"),e("em",[this._v("*")])])}]};var m=a("VU/8")(p,d,!1,function(t){a("d3Rc")},"data-v-ee396434",null);e.default=m.exports},LmyP:function(t,e,a){"use strict";var s=a("Dd8w"),i=a.n(s),n=a("2bvH"),r={data:function(){return{paginationShow:!0}},computed:i()({},Object(n.b)({pageTotal:"pageTotal"})),methods:{handleCurrentChange:function(t){this.$store.commit("PAGE",{pageTotal:this.pageTotal,pageNum:t})}}},o={render:function(){var t=this.$createElement,e=this._self._c||t;return this.paginationShow?e("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next",total:this.pageTotal},on:{"current-change":this.handleCurrentChange}}):this._e()},staticRenderFns:[]},l=a("VU/8")(r,o,!1,null,null,null);e.a=l.exports},PJJV:function(t,e){},d3Rc:function(t,e){}});